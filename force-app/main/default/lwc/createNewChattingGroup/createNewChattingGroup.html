<template>
    <section class="slds-modal slds-fade-in-open slds-modal_medium">
        <div class="slds-modal__container">
            <div class="slds-button slds-button_icon slds-modal__close slds-button_icon-inverse">
                <lightning-button-icon icon-name="utility:close" variant="container" onclick={handleClose} alternative-text="취소" title="취소"></lightning-button-icon>
            </div>
            <div class="slds-modal__header">
                <h1 class="slds-modal__title slds-hyphenate">새로운 채팅 시작하기</h1>
            </div>
            <div class="slds-modal__content slds-p-around_medium">
                <div class="input-container">
                    <lightning-layout multiple-rows="true" >
                        <lightning-layout-item size="6" padding="around-small">
                            <lightning-input type="checkbox" label="비밀 채팅으로 만들기" onclick={handleTogglePrivate} name="isPrivate"></lightning-input>
                        </lightning-layout-item>
                        <lightning-layout-item size="6" padding="around-small"></lightning-layout-item>
                        <lightning-layout-item size="6" padding="around-small">
                            <lightning-input type="text" label="채팅방 이름" required="true" name="name"></lightning-input>
                        </lightning-layout-item>
                        <lightning-layout-item size="6" padding="around-small">
                            <template lwc:if={isShowPassword}><lightning-input type="password" label="채팅방 비밀번호" required="true" name="password"></lightning-input></template>
                        </lightning-layout-item>
                        <lightning-layout-item size="6" padding="around-small">
                            <div class="slds-form-element__control">
                                <div class="slds-combobox_container">
                                    <div class="user-dropdown slds-combobox slds-dropdown-trigger slds-dropdown-trigger_click user-dropdown-box" onmouseleave={handleMouseleave}> <!-- slds-is-open -->
                                        <lightning-input type="search" label="채팅방 친구 초대" class="user-search-input" onchange={handleSearchValue} onkeyup={handleKeyup} onmouseover={handleMouseover} onclick={handleClickSearchInput} onfocus={handleSearchFocus} name="none"></lightning-input>
                                        <div class="slds-dropdown slds-dropdown_length-with-icon-7 slds-dropdown_fluid" style="max-height: 180px;">
                                            <template lwc:if={isSearching} >
                                                <div style="height: 20px;"><lightning-spinner alternative-text="Loading" size="small"></lightning-spinner></div>
                                            </template>
                                            <template lwc:else >
                                                <ul class="slds-listbox slds-listbox_vertical">
                                                    <template lwc:if={isNoResults}>
                                                        <li class="slds-listbox__item">
                                                            <div class="slds-media slds-listbox__option slds-listbox__option_entity slds-listbox__option_has-meta">
                                                                <span class="slds-media__body" style="margin: auto;">사용자를 찾지 못했습니다.ㅠㅠ</span>
                                                            </div>
                                                        </li>
                                                    </template>
                                                    <template lwc:else >
                                                        <template for:each={users} for:item="item" for:index="idx" >
                                                            <li class="slds-listbox__item" data-recordid={item.recordId} onclick={handleSelectItem} key={item.recordId}>
                                                                <div class="slds-media slds-listbox__option slds-listbox__option_entity slds-listbox__option_has-meta">
                                                                    <span class="slds-media__figure slds-listbox__option-icon">
                                                                        <div class="avatar-container"><img src={item.photoUrl} /></div>
                                                                    </span>
                                                                    <span class="slds-media__body" style="margin: auto;">{item.name}</span>
                                                                </div>
                                                            </li>
                                                        </template>
                                                    </template>
                                                </ul>
                                            </template>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </lightning-layout-item>
                        <lightning-layout-item size="6" padding="around-small">
                            <div>
                                <lightning-pill-container items={selectUsers} onitemremove={handleItemRemove}></lightning-pill-container>
                            </div>
                        </lightning-layout-item>
                    </lightning-layout>
                    </div>
                </div>
                <div class="slds-modal__footer">
                    <button class="slds-button slds-button_neutral" onclick={handleClose}>취소</button>
                    <button class="slds-button slds-button_brand" onclick={handleSave}>시작하기</button>
                </div>
            </div>
        </div>
    </section>
    <div class="slds-backdrop slds-backdrop_open"></div>
</template>